import{r as c,j as e,m as O,o as P,F as N,I as E,J as k,K as I,M as U,U as C,N as R,s as L,O as F}from"./index-BKCAaXJM.js";import{L as M}from"./Logo-ZPx9d4ZC.js";import{c as A}from"./utils-BNAcYRAX.js";import{B as v}from"./Button-B7sMKDAv.js";import"https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";import"https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js";import"./classNames-B5Uz2kxj.js";const y=c.forwardRef(({className:u,type:n,...t},i)=>e.jsx("input",{type:n,className:A("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",u),ref:i,...t}));y.displayName="Input";const B=({className:u,onOtpSend:n,onOtpVerify:t})=>{const[i,g]=c.useState("phone"),[o,f]=c.useState(""),[l,h]=c.useState(""),[d,s]=c.useState(!1),r=async()=>{if(!o||o.length<8){alert("Enter a valid phone number");return}s(!0);try{await(n==null?void 0:n(o)),h(""),g("otp")}finally{s(!1)}},p=async()=>{if(!l||l.length!==4){alert("OTP must be 4 digits");return}s(!0);try{await(t==null?void 0:t(o,l))}finally{s(!1)}};return e.jsx("div",{className:u,children:i==="phone"?e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2",children:"Mobile Number"}),e.jsx(y,{type:"tel",placeholder:"98765 43210",value:o,className:"!text-black bg-white focus:bg-white mb-4",onChange:a=>f(a.target.value)}),e.jsx(v,{block:!0,loading:d,variant:"solid",onClick:r,children:d?"Sending OTP...":"Send OTP"})]}):e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-2",children:["Enter OTP sent to ",o]}),e.jsx(y,{type:"text",placeholder:"Enter OTP",value:l,maxLength:4,className:"!text-black bg-white focus:bg-white mb-4",onChange:a=>h(a.target.value)}),e.jsx(v,{block:!0,loading:d,variant:"solid",onClick:p,children:d?"Verifying...":"Verify OTP"}),e.jsx(v,{block:!0,variant:"default",className:"mt-2",onClick:()=>{g("phone"),f(""),h("")},children:"Change Number"})]})})};function D(u=3e3){const[n,t]=c.useState("");return c.useEffect(()=>{if(n){const i=setTimeout(()=>t(""),u);return()=>{clearTimeout(i)}}},[n]),[n,t]}const V=({disableSubmit:u})=>{const[n,t]=D(),i=O(s=>s.mode),g=P(s=>s.setUser),o=P(s=>s.setSessionSignedIn),{setToken:f}=N(),l=E(),h=async s=>{try{console.log("Sending OTP to",s);const r=await F({phone:s});if(r.status==1)t("OTP sent successfully!");else throw new Error(r.message||"Failed to send OTP")}catch(r){console.error(r),t("Failed to send OTP. Please try again.")}},d=async(s,r)=>{var p;try{console.log("Verifying OTP",{phone:s,otp:r});const a=await k({phone:s,otp:r});if(a.status==1&&((p=a.data)!=null&&p.token)){const T=a.data.token,m=a.data.user;if(!m.avatar){const S=m.userName||m.phone||"User";m.avatar=`https://ui-avatars.com/api/?name=${encodeURIComponent(S)}`}const b=m.roles||[],x=[];b.includes("admin")&&x.push(I),b.includes("developer")&&x.push(U),b.includes("user")&&x.push(C),f(T),o(!0),g({...m,roles:b,authority:x});const j=window.location.search,w=new URLSearchParams(j).get(R);l(w||L.authenticatedEntryPath)}else throw new Error(a.message||"Invalid OTP");t("OTP verified successfully! Logged in.")}catch(a){console.error(a),t("Invalid OTP. Please try again.")}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex mb-3",children:e.jsx(M,{type:"long",mode:i,logoWidth:320})}),e.jsxs("div",{className:"mb-10 px-4",children:[e.jsx("h3",{className:"mb-2 text-white",children:"Welcome!"}),e.jsx("p",{className:"font-light text-xs text-white",children:"Please enter your mobile number to sign in!"})]}),e.jsx(B,{className:"px-4 text-white",onOtpSend:h,onOtpVerify:d})]})},G=()=>e.jsx(V,{});export{V as SignInBase,G as default};
