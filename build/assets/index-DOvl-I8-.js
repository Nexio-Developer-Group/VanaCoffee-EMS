import{r as n,K as I,j as e}from"./index-CB9FBUrv.js";import{g as z,u as V,d as D}from"./BillService-CMQwPAMG.js";import{I as E}from"./Input-dO6Im5wp.js";import{B as o}from"./Button-DxEFrSJ6.js";import{S as v,a as N,b as f,c as S,d}from"./select-D3GJjIu1.js";import{c as b}from"./createLucideIcon-BhX0PSqU.js";import"https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";import"https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js";import"./isNil-CYCsRoGv.js";import"./classNames-BBN42WBN.js";import"./index-DIZsMau0.js";import"./floating-ui.react-dom-CqzLph7T.js";import"./utils-Dk9uDfko.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],L=b("eye",F);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],W=b("trash-2",q),se=()=>{const[m,p]=n.useState([]),[P,j]=n.useState(!1),[x,k]=n.useState(""),[i,w]=n.useState("all"),[r,u]=n.useState(1),[g,C]=n.useState(1),T=I(),y=async()=>{j(!0);try{const s={page:r};i!=="all"&&(s.status=i),x&&(s.phone=x);const t=await z(s);p(t.data),C(t.pages)}catch(s){console.error(s)}finally{j(!1)}};n.useEffect(()=>{y()},[r,i]);const B=async(s,t)=>{try{await V(s,t),p(a=>a.map(c=>c._id===s?{...c,status:t}:c))}catch(a){console.error(a)}},M=async s=>{if(confirm("Are you sure you want to delete this bill?"))try{await D(s),p(t=>t.filter(a=>a._id!==s))}catch(t){console.error(t)}},_=()=>{u(1),y()},A=s=>{const t=s.items.reduce((l,h)=>l+h.price*h.quantity,0),a=t-(s.discount||0),c=s.items.map(l=>({...l,total:l.price*l.quantity}));return{subTotal:t,grandTotal:a,itemsWithTotal:c}};return e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Bills"}),e.jsxs("div",{className:"flex gap-4 mb-4 items-center",children:[e.jsx(E,{placeholder:"Search by phone",value:x,onChange:s=>k(s.target.value)}),e.jsxs(v,{value:i,onValueChange:s=>w(s),children:[e.jsx(N,{className:"w-40",children:e.jsx(f,{placeholder:"Filter by status"})}),e.jsxs(S,{children:[e.jsx(d,{value:"all",children:"All Status"}),e.jsx(d,{value:"pending",children:"Pending"}),e.jsx(d,{value:"paid",children:"Paid"}),e.jsx(d,{value:"cancelled",children:"Cancelled"})]})]}),e.jsx(o,{onClick:_,children:"Search"})]}),e.jsxs("table",{className:"min-w-full border rounded overflow-hidden",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"Bill ID"}),e.jsx("th",{className:"p-2 border",children:"Phone"}),e.jsx("th",{className:"p-2 border",children:"Total Amount"}),e.jsx("th",{className:"p-2 border",children:"Status"}),e.jsx("th",{className:"p-2 border",children:"Payment Mode"}),e.jsx("th",{className:"p-2 border",children:"Actions"})]})}),e.jsx("tbody",{children:P?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center p-4",children:"Loading..."})}):m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center p-4",children:"No bills found."})}):m.map(s=>{const{subTotal:t,grandTotal:a,itemsWithTotal:c}=A(s),l={billId:s.billId,user:s._id,phone:s.phone,items:c,subTotal:t,discount:s.discount,grandTotal:a,paymentMethod:s.paymentMethod,status:s.status,createdAt:s.createdAt};return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 border",children:s.billId}),e.jsx("td",{className:"p-2 border",children:s.phone}),e.jsxs("td",{className:"p-2 border",children:["â‚¹",a.toFixed(2)]}),e.jsx("td",{className:"p-2 border",children:e.jsxs(v,{value:s.status,onValueChange:h=>B(s._id,h),children:[e.jsx(N,{className:"w-32",children:e.jsx(f,{placeholder:"Select status"})}),e.jsxs(S,{children:[e.jsx(d,{value:"pending",children:"Pending"}),e.jsx(d,{value:"paid",children:"Paid"}),e.jsx(d,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsx("td",{className:"p-2 border",children:s.paymentMethod}),e.jsxs("td",{className:"p-2 border flex justify-center gap-2",children:[e.jsx(o,{size:"xs",onClick:()=>T("/bill-preview",{state:{billData:l}}),children:e.jsx(L,{size:16})}),e.jsx(o,{size:"xs",variant:"solid",className:"bg-red-500 hover:bg-red-600 text-white",onClick:()=>M(s._id),children:e.jsx(W,{size:16})})]})]},s._id)})})]}),e.jsxs("div",{className:"mt-4 flex justify-center gap-2",children:[e.jsx(o,{disabled:r<=1,onClick:()=>u(r-1),children:"Previous"}),e.jsxs("span",{className:"flex items-center px-2",children:[r," / ",g]}),e.jsx(o,{disabled:r>=g,onClick:()=>u(r+1),children:"Next"})]})]})};export{se as default};
