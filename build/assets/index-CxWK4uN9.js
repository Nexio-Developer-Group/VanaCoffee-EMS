import{r as n,K as A,j as e}from"./index-BJ57Odm-.js";import{g as I,u as V,d as q}from"./BillService-Cvv_QPqa.js";import{I as D,S as f,a as S,b,c as k,d}from"./select-0RswQJyk.js";import{B as o}from"./Button-7Tz0rUHs.js";import{c as m}from"./createLucideIcon-BJHE781N.js";import"https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";import"https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js";import"./isNil-Cy_hEUtT.js";import"./index-DbyFNifg.js";import"./utils-fzJQ3yUy.js";import"./classNames-6HTn5c6X.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],F=m("eye",E);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],$=m("square-pen",L);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],W=m("trash-2",H),se=()=>{const[j,x]=n.useState([]),[P,g]=n.useState(!1),[p,C]=n.useState(""),[i,_]=n.useState("all"),[r,u]=n.useState(1),[y,w]=n.useState(1),v=A(),N=async()=>{g(!0);try{const s={page:r};i!=="all"&&(s.status=i),p&&(s.phone=p);const t=await I(s);x(t.data),w(t.pages)}catch(s){console.error(s)}finally{g(!1)}};n.useEffect(()=>{N()},[r,i]);const M=async(s,t)=>{try{await V(s,t),x(a=>a.map(c=>c._id===s?{...c,status:t}:c))}catch(a){console.error(a)}},T=async s=>{if(confirm("Are you sure you want to delete this bill?"))try{await q(s),x(t=>t.filter(a=>a._id!==s))}catch(t){console.error(t)}},B=()=>{u(1),N()},z=s=>{const t=s.items.reduce((l,h)=>l+h.price*h.quantity,0),a=t-(s.discount||0),c=s.items.map(l=>({...l,total:l.price*l.quantity}));return{subTotal:t,grandTotal:a,itemsWithTotal:c}};return e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Bills"}),e.jsxs("div",{className:"flex gap-4 mb-4 items-center",children:[e.jsx(D,{placeholder:"Search by phone",value:p,onChange:s=>C(s.target.value)}),e.jsxs(f,{value:i,onValueChange:s=>_(s),children:[e.jsx(S,{className:"w-40",children:e.jsx(b,{placeholder:"Filter by status"})}),e.jsxs(k,{children:[e.jsx(d,{value:"all",children:"All Status"}),e.jsx(d,{value:"pending",children:"Pending"}),e.jsx(d,{value:"paid",children:"Paid"}),e.jsx(d,{value:"cancelled",children:"Cancelled"})]})]}),e.jsx(o,{onClick:B,children:"Search"})]}),e.jsxs("table",{className:"min-w-full border rounded overflow-hidden",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"Bill ID"}),e.jsx("th",{className:"p-2 border",children:"Phone"}),e.jsx("th",{className:"p-2 border",children:"Total Amount"}),e.jsx("th",{className:"p-2 border",children:"Status"}),e.jsx("th",{className:"p-2 border",children:"Payment Mode"}),e.jsx("th",{className:"p-2 border",children:"Actions"})]})}),e.jsx("tbody",{children:P?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center p-4",children:"Loading..."})}):j.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center p-4",children:"No bills found."})}):j.map(s=>{const{subTotal:t,grandTotal:a,itemsWithTotal:c}=z(s),l={billId:s.billId,user:s._id,phone:s.phone,items:c,subTotal:t,discount:s.discount,grandTotal:a,paymentMethod:s.paymentMethod,status:s.status,createdAt:s.createdAt};return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 border",children:s.billId}),e.jsx("td",{className:"p-2 border",children:s.phone}),e.jsxs("td",{className:"p-2 border",children:["â‚¹",a.toFixed(2)]}),e.jsx("td",{className:"p-2 border",children:e.jsxs(f,{value:s.status,onValueChange:h=>M(s._id,h),children:[e.jsx(S,{className:"w-32",children:e.jsx(b,{placeholder:"Select status"})}),e.jsxs(k,{children:[e.jsx(d,{value:"pending",children:"Pending"}),e.jsx(d,{value:"paid",children:"Paid"}),e.jsx(d,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsx("td",{className:"p-2 border",children:s.paymentMethod}),e.jsxs("td",{className:"p-2 border flex justify-center gap-2",children:[e.jsx(o,{size:"xs",onClick:()=>v(`/bills/edit/${s._id}`),children:e.jsx($,{size:16})}),e.jsx(o,{size:"xs",onClick:()=>v("/bill-preview",{state:{billData:l}}),children:e.jsx(F,{size:16})}),e.jsx(o,{size:"xs",variant:"solid",className:"bg-red-500 hover:bg-red-600 text-white",onClick:()=>T(s._id),children:e.jsx(W,{size:16})})]})]},s._id)})})]}),e.jsxs("div",{className:"mt-4 flex justify-center gap-2",children:[e.jsx(o,{disabled:r<=1,onClick:()=>u(r-1),children:"Previous"}),e.jsxs("span",{className:"flex items-center px-2",children:[r," / ",y]}),e.jsx(o,{disabled:r>=y,onClick:()=>u(r+1),children:"Next"})]})]})};export{se as default};
