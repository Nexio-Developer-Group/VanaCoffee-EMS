import{r as a,j as e}from"./index-DZ-AIEAR.js";import{B as g}from"./Button-DhmoVr0K.js";import{I as b}from"./Input-CIxmVj9x.js";import{S as w,a as I,b as _,c as A,d as N}from"./select-Biipefgd.js";import{d as F,u as z,c as M,g as O}from"./ItemService-DtvERxJJ.js";import{D as R,a as V,b as E,c as B,F as H,d as S,e as L}from"./FormItem-qq1dN00n.js";import{g as k}from"./CategoryService-CLGH_dIz.js";import"https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";import"https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js";import"./classNames-DsZqLZGS.js";import"./isNil-BYWnTsQi.js";import"./index-BXBdT1Dw.js";import"./floating-ui.react-dom-DKYihmkr.js";import"./utils-D71Su6D3.js";import"./createLucideIcon-C54T8stW.js";import"./index-DS6dusH5.js";const D=a.forwardRef(({fetchItems:f,onEdit:x},l)=>{const[p,y]=a.useState([]),[j,i]=a.useState(!1),[c,n]=a.useState(1),[m,h]=a.useState(1),o=a.useCallback(async(r=1)=>{i(!0);try{const s=await f(r);y(s.items),n(s.page),h(s.pages)}catch(s){console.error(s)}finally{i(!1)}},[f]);a.useEffect(()=>{o()},[o]),a.useImperativeHandle(l,()=>({reload:()=>o(c)}));const v=a.useCallback(async r=>{if(confirm("Are you sure you want to delete this item?")){i(!0);try{await F(r),await o(c)}catch(s){console.error(s)}finally{i(!1)}}},[o,c]),u=r=>{r<1||r>m||o(r)};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-medium text-gray-700",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-medium text-gray-700",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-medium text-gray-700",children:"Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-sm font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:p.length>0?p.map(r=>{var s;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:((s=r.category)==null?void 0:s.name)||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.formattedPrice||r.price}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.isActive?"Active":"Inactive"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap flex justify-end space-x-2",children:[e.jsx(g,{size:"sm",variant:"default",onClick:()=>x(r),children:"Edit"}),e.jsx(g,{size:"sm",variant:"solid",onClick:()=>v(r._id),children:"Delete"})]})]},r._id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-4 text-center text-gray-500",children:j?"Loading...":"No items found"})})})]})}),e.jsxs("div",{className:"flex justify-center space-x-2 mt-2",children:[e.jsx(g,{size:"sm",variant:"default",disabled:c===1,onClick:()=>u(c-1),children:"Previous"}),e.jsxs("span",{className:"px-2 py-1 bg-gray-100 rounded",children:[c," / ",m]}),e.jsx(g,{size:"sm",variant:"default",disabled:c===m,onClick:()=>u(c+1),children:"Next"})]})]})});D.displayName="ItemTable";const U=({isOpen:f,onClose:x,itemToEdit:l,onSuccess:p})=>{const[y,j]=a.useState(""),[i,c]=a.useState(""),[n,m]=a.useState(null),[h,o]=a.useState(0),[v,u]=a.useState(!0),[r,s]=a.useState([]),d=async()=>{try{const t=await k();s(t.data)}catch(t){console.error(t)}};a.useEffect(()=>{d()},[]),a.useEffect(()=>{l?(j(l.name),c(l.description||""),m(r.find(t=>{var C;return t._id===((C=l.category)==null?void 0:C._id)})||null),o(l.price),u(l.isActive)):(j(""),c(""),m(null),o(0),u(!0))},[l,r]);const P=async()=>{if(!(n!=null&&n._id)){alert("Please select a category");return}const t={name:y,description:i,category:n._id,price:h,isActive:v};try{l?await z(l._id,t):await M(t),p(),x()}catch(C){console.error(C)}};return e.jsx(R,{open:f,onOpenChange:t=>!t&&x(),children:e.jsxs(V,{children:[e.jsx(E,{children:e.jsx(B,{children:l?"Edit Item":"Create Item"})}),e.jsxs(H,{className:"space-y-4",children:[e.jsx(S,{label:"Name",children:e.jsx(b,{value:y,onChange:t=>j(t.target.value)})}),e.jsx(S,{label:"Description",children:e.jsx(b,{value:i,onChange:t=>c(t.target.value)})}),e.jsx(S,{label:"Category",children:e.jsxs(w,{value:(n==null?void 0:n._id)??"none",onValueChange:t=>m(t==="none"?null:r.find(C=>C._id===t)||null),children:[e.jsx(I,{children:e.jsx(_,{placeholder:"Select Category"})}),e.jsxs(A,{className:"max-h-60 overflow-auto",children:[e.jsx(N,{value:"none",children:"None"}),r.map(t=>e.jsx(N,{value:t._id,children:t.name},t._id))]})]})}),e.jsx(S,{label:"Price",children:e.jsx(b,{type:"number",value:h,onChange:t=>o(Number(t.target.value))})}),e.jsx(S,{label:"Status",children:e.jsxs(w,{value:v?"active":"inactive",onValueChange:t=>u(t==="active"),children:[e.jsx(I,{children:e.jsx(_,{})}),e.jsxs(A,{children:[e.jsx(N,{value:"active",children:"Active"}),e.jsx(N,{value:"inactive",children:"Inactive"})]})]})})]}),e.jsxs(L,{className:"flex justify-end space-x-2 mt-4",children:[e.jsx(g,{variant:"default",onClick:x,children:"Cancel"}),e.jsx(g,{onClick:P,children:l?"Update":"Create"})]})]})})},le=()=>{const[f,x]=a.useState(!1),[l,p]=a.useState(),[y,j]=a.useState([]),[i,c]=a.useState("all"),[n,m]=a.useState(""),h=a.useRef(null);a.useEffect(()=>{(async()=>{try{const d=await k();j(d.data)}catch(d){console.error(d)}})()},[]);const o=a.useCallback(async(s=1)=>{try{const d=await O({page:s,limit:10,category:i!=="all"?i:void 0,search:n});return{items:d.items,total:d.total,page:d.page,pages:d.pages}}catch(d){return console.error(d),{items:[],total:0,page:s,pages:0}}},[i,n]),v=()=>{p(void 0),x(!0)},u=s=>{p(s),x(!0)},r=async()=>{h.current&&h.current.reload()};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-4 items-center",children:[e.jsx("h1",{className:"text-lg font-bold",children:"Items"}),e.jsx(g,{variant:"solid",size:"sm",onClick:v,children:"Create Item"})]}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsx(b,{placeholder:"Search items...",value:n,size:"sm",className:"max-w-xs",onChange:s=>m(s.target.value)}),e.jsxs(w,{value:i,onValueChange:s=>c(s),children:[e.jsx(I,{className:"w-[180px]",children:e.jsx(_,{placeholder:"Filter by category"})}),e.jsxs(A,{className:"max-h-60 overflow-auto",children:[e.jsx(N,{value:"all",children:"All"}),y.map(s=>e.jsx(N,{value:s._id,children:s.name},s._id))]})]})]}),e.jsx(D,{ref:h,fetchItems:o,onEdit:u}),e.jsx(U,{isOpen:f,itemToEdit:l,onClose:()=>x(!1),onSuccess:r})]})};export{le as default};
